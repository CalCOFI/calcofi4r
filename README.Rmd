---
title: "calcofi4r"
output:
  github_document:
    html_preview: false
editor_options: 
  chunk_output_type: console
---

R package of helper functions for reading and visualizing data from the CalCOFI API at [api.calcofi.io](https://api.calcofi.io).

```{r knitr, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path="man/figures/"
)
# devtools::document()
# devtools::install_local(here::here(), force=T) # install local
```

## Install R package

```{r, include = FALSE}
# install.packages("devtools")
# remotes::install_github("calcofi/calcofi4r")
devtools::load_all()
```

## Map contours

Map contours of an oceanographic variable from CTD cast bottle data.

```{r map_contours}
# map contours, aka isobands, of variable using generalized additive model (GAM)
v_ply <- map_contours(
  df = bottle_temp_lonlat, ply = area_calcofi_extended)

# show contour polygons on map 
mapview::mapView(v_ply, zcol="v", layer.name="temp(ÂºC)")
```

## Plot time series

Plot time series of an oceanographic variable from CTD cast bottle data.

```{r plot_timeseries}
library(calcofi4r)

# get variables
(v <- get_variables())

# fetch time series data for the first variable from CalCOFI API
(d <- get_timeseries(v$table_field[1]))

# plot time series with the first variable
with(v[1,],
  plot_timeseries(
    # data and columns (from d)
    d, year, val_avg, val_sd,
    # plot attributes (from v)
    plot_title, plot_label, plot_color))
```

## Plot depth

Plot depth of an oceanographic variable from CTD cast bottle data.


```{r plot_depth}
head(bottle_temp_depth)

# plot depth with the station data
plot_depth(
  df = bottle_temp_depth, variable = "Temperature",
  interactive = F)
```

## Map raster

Map raster of interpolated oceanographic variable for a cruise.

```{r map_raster}
# get cruises
(z <- get_cruises())

# get path of temporary file to store raster
(r_tif <- tempfile(fileext=".tif"))

# use second variable from previously fetched v
c(v$table_field[2], v$plot_label[2])

# fetch interpolated raster from CalCOFI API
get_raster(
  variable = v$table_field[2],
  cruise_id = "2020-01-05-C-33RL",
  depth_m_min = 0, depth_m_max = 200,
  out_tif = r_tif)

# read raster
r <- raster::raster(r_tif)

# plot raster
map_raster(r, v$plot_label[2])
```

```{r cleanup}
# cleanup by deleting temporary file
unlink(r_tif)
```

## Code of Conduct

Please note that the `calcofi4r` project is released with a [Contributor Code of Conduct](https://calcofi.github.io/calcofi4r/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
